<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <style>
      @font-face {
        font-family: "mainfont";
        /**
         * Copyright Information of Inconsolata.otf
         * Lisence: Open Font Lisence
         * Author: Raph Levien
         * URL: http://www.levien.com/type/myfonts/inconsolata.html
         */
        src: url("Inconsolata.otf") format("opentype");
      }
      body {
        font-family: "mainfont";
        font-size: 20px;
      }
      pre {
        background-color: black;
        color: white;
        padding: 10px;
      }
      code {
        font-family: "mainfont";
      }
      kbd {
        color: yellow;
        font-weight: bold;
      }
    </style>
    <title>Unnamed Backup Tool</title>
  <body>
    <h1>Unnamed Backup Tool</h1>
    <section>
      <h1><a href="#description" name="description">*</a> Description</h1>
      <p>Unnamed Backup Tool is a backup tool for Unix. Features are;</p>
      <ul>
        <li>backuping to a remote server or a local directory.</li>
        <li>using SSH for remote backup.</li>
        <li>backuping into <code><var>year</var>-<var>month</var>-<var>day</var>T<var>hour</var>:<var>minute</var>:<var>second</var>,<var>millisecond</var></code> directory.</li>
        <li>incremental backup using hard links. If a file is unchanged, Unnamed
        Backup Tool makes a hard link to a previous one.</li>
        <li>backuping not only files itself, but also metadata such as
        permissions and owners under <code>.meta</code> directory.</li>
        <li>acceptable UTF-8 filename.</li>
      </ul>
    </section>
    <section>
      <h1><a href="#requirements" name="requirements">*</a> Requirements</h1>
      <ul>
        <li><a href="http://FreeBSD.org">FreeBSD</a> 8.2, 8.1</li>
        <li>x86</li>
        <li>ssh (for remote backup)</li>
      </ul>
    </section>
    <section>
      <h1><a href="#download" name="download">*</a> Download</h1>
      <p>TODO: Decide here</p>
    </section>
    <section>
      <h1>
        <a href="#how-to-install" name="how-to-install">*</a> How to Install
      </h1>
      <p>Read <code>INSTALL</code> and do;</p>
      <pre><code>$ <kbd>./configure &amp;&amp; make &amp;&amp; sudo make install</kbd></code></pre>
      <p>If you want remote backup, you must install Unnamed Backup Tool to a
      client and a server.</p>
    </section>
    <section>
      <h1><a href="#how-to-use" name="how-to-use">*</a> How to Use</h1>
      <section>
        <h1>
          <a href="#remote-backup" name="remote-backup">*</a> Remote Backup
        </h1>
        <p>If you want to backup <code>/etc</code> and <code>/usr/home</code> in
        localhost to <code>/backup/foo</code> in <code>example.com</code>,
        you must do;</p>
        <pre>$ <kbd>ubtc --hostname=example.com /etc /usr/home /backup/foo<kbd></pre>
        <p>You must give <code>--hostname</code> option to ubtc, and place a
        destination directory (this is a directory in a server, not in
        localhost) at last.</p>
        <p>ubtc trys to connect a server with ssh. If you must give a username
        to ssh, you can give
        <code>--hostname=<var>username</var>@example.com</code> option.</p>
      </section>
      <section>
        <h1><a href="#local-backup" name="local-backup">*</a> Local Backup</h1>
        <p>If you want to backup <code>/etc</code> and <code>/usr/home</code> in
        localhost to <code>/backup/foo</code> in localhost, you must do;</p>
        <pre>$ <kbd>ubtc --local /etc /usr/home /backup/foo<kbd></pre>
        <p>You must give <code>--local</code> option to ubtc, and place a
        destination directory at last.</p>
      </section>
    </section>
    <section>
      <h1>
        <a href="#structure-of-backup-directory" name="structure-of-backup-directory">*</a> Structure of Backup Directory
      </h1>
      <section>
        <h1>
          <a href="#timestamp-directory" name="timestamp-directory">*</a>
          Timestamp Directory
        </h1>
        <p>If you run <code>ubtc --hostname=example.com /etc /backup</code>,
        Unnamed Backup Tool will make a directory of
        <code>/backup/<var>timestamp</var></code> in example.com.
        <var>timestamp</var> is in a form of
        <code><var>year</var>-<var>month</var>-<var>day</var>T<var>hour</var>:<var>minute</var>:<var>second</var>,<var>millisecond</var></code> (this is told in
        <a href="#description">Description</a> section). <code>/etc</code>
        directory will be backuped at
        <code>/backup/<var>timestamp</var>/etc</code>.</p>
      </section>
      <section>
        <h1><a href="#hard-links" name="hard-links">*</a> Hard Links</h1>
        <p>Assume that you backuped <code>/etc</code> directory twice, first
        timestamp is <var>timestamp0</var>, second timestamp is
        <var>timestamp1</var>. If a destination directory is
        <code>/backup</code>, you have following two directory trees.</p>
        <ul>
          <li><code>/backup/<var>timestamp0</var>/etc</code></li>
          <li><code>/backup/<var>timestamp1</var>/etc</code></li>
        </ul>
        <p>Your <code>/etc</code> directory may have <code>syslog.conf</code>,
        so you may have following two files.</p>
        <ul>
          <li><code>/backup/<var>timestamp0</var>/etc/syslog.conf</code></li>
          <li><code>/backup/<var>timestamp1</var>/etc/syslog.conf</code></li>
        </ul>
        <p>If you did not change <code>/etc/syslog.conf</code> between two
        backups, <code>syslog.conf</code> under
        <code><var>timestamp1</var></code> is a hard link to
        <code>/backup/<var>timestamp0</var>/etc/syslog.conf</code>. You can see
        this with <code>ls -i /backup/*/etc/syslog.conf</code>. Unnamed Backup
        Tool trys to use less disk space in this way.</p>
        <p>If you changed <code>/etc/syslog.conf</code> between two backups, new
        one was copied to
        <code>/backup/<var>timestamp1</var>/etc/syslog.conf</code> without using
        a hard link, of course.</p>
      </section>
      <section>
        <h1>
          <a href="#meta-directory" name="meta-directory">*</a>
          <code>.meta</code> Directory
        </h1>
        <p>Each directory has <code>.meta</code> directory, which contains meta
        data of files in the directory. A meta data file of <code>foo</code> is
        <code>.meta/foo.meta</code>. This file has mode, uid and gid in each
        line.</p>
      </section>
      <section>
        <h1>
          <a href="#backup-from-root" name="backup-from-root">*</a>
          Backup from <code>/</code> (root)
        </h1>
        <p>Even if you do
        <code>ubtc --hostname=example.com /usr/home /backup</code>, you will get
        <code>/backup/<var>timestamp</var>/usr/home</code> directory, NOT
        <code>/backup/<var>timestamp</var>/home</code> directory. Unnamed Backup
        Tool also backups parent directoies of specified directories as well as
        specified directories itself.</p>
      </section>
    </section>
    <section>
      <h1>
        <a href="#protocol-between-a-server-and-a-client" name="protocol-between-a-server-and-a-client">*</a>
        Protocol between a Server and a Client
      </h1>
      <p>Unnamed Backup Tool uses CRLF.</p>
      <section>
        <h1><code>DIR</code> command</h1>
        <section>
          <h1>Format</h1>
          <p><code>DIR <var>name</var> <var>mode</var> <var>uid</var> <var>gid</var> <var>ctime</var></code></p>
        </section>
        <section>
          <h1>Response</h1>
          <p><code>OK</code> or <code>NG</code>.</p>
        </section>
      </section>
      <section>
        <h1><code>FILE</code> command</h1>
        <section>
          <h1>Format</h1>
          <p><code>FILE <var>name</var> <var>mode</var> <var>uid</var> <var>gid</var> <var>mtime</var> <var>ctime</var></code></p>
        </section>
        <section>
          <h1>Response</h1>
          <p><code>CHANGED</code>, <code>UNCHANGED</code> or <code>NG</code>.
          </p>
        </section>
        <section>
          <h1>Description</h1>
          <p>Servers must memorize <var>name</var> for next <code>BODY</code>
          command.</p>
        </section>
      </section>
      <section>
        <h1><code>BODY</code> command</h1>
        <section>
          <h1>Format</h1>
          <p><code>BODY <var>size</var></code></p>
        </section>
        <section>
          <h1>Response</h1>
          <p><code>OK</code> or <code>NG</code>.</p>
        </section>
        <section>
          <h1>Description</h1>
          <p>File body follows after a CRLF. Clients must specify filename with
          FILE command previously.</p>
        </section>
      </section>
      <section>
        <h1><code>SYMLINK</code> command</h1>
        <section>
          <h1>Format</h1>
          <p><code>SYMLINK <var>name</var> <var>mode</var> <var>uid</var> <var>gid</var> <var>ctime</var> <var>src</var></code></p>
        </section>
        <section>
          <h1>Response</h1>
          <p><code>OK</code> or <code>NG</code>.</p>
        </section>
      </section>
      <section>
        <h1><code>THANK_YOU</code> command</h1>
        <section><h1>Format</h1><p><code>THANK_YOU</code></p></section>
        <section>
          <h1>Response</h1>
          <p>Nothing. It does not mean that a server response
          <code>Nothing</code> command. It means that a server will disconnect
          soon without response.</p>
        </section>
        <section>
          <h1>Description</h1>
          <p>Clients declare end of connection with this command.</p>
        </section>
      </section>
    </section>
    <section>
      <h1><a href="#author" name="author">*</a> Author</h1>
      <p>The author of Unnamed Backup Tool is
      <a href="http://neko-daisuki.ddo.jp/~SumiTomohiko">SumiTomohiko</a>.</p>
  </body>
</html>
<!--
vim: tabstop=2 shiftwidth=2 expandtab softtabstop=2
-->
